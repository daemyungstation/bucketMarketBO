<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BasicProduct">

    <!-- 관리자 > 결합상품관리 > 조건절 -->
    <sql id="productWhere">
        <where>
            <if test="searchStartDate != null and searchStartDate != '' and searchEndDate != null and searchEndDate != ''">
                AND TPM.PRD_MST_REG_DT BETWEEN REPLACE(#{searchStartDate},'-', '')||'000000' AND REPLACE(#{searchEndDate},'-', '')||'235959'
            </if>
            <if test="searchVdrMstIdx != null and searchVdrMstIdx !=''">
                AND TPM.VDR_MST_IDX = #{searchVdrMstIdx}
            </if>
            <if test="searchSupplyNm != null and searchSupplyNm != ''">
                AND DBMS_LOB.INSTR( PRD_MST_SPL_NM, #{searchSupplyNm}) > 0
            </if>
            <if test="searchPrdMstPrpYn != null and searchPrdMstPrpYn != ''">
                AND TPM.PRD_MST_PRP_YN = #{searchPrdMstPrpYn}
            </if>
            <if test="searchModelNm != null and searchModelNm != ''">
                AND DBMS_LOB.INSTR(PRD_MST_MD, #{searchModelNm}) > 0
            </if>     
            <if test="searchApvState != null and searchApvState != ''">
                <if test="searchApvState.equals(@common.code.Product@STATE_STOP)">
                AND PRD_MST_APV_STATE IN ('N','R')
                </if>
                <if test="!searchApvState.equals(@common.code.Product@STATE_STOP)">
                AND PRD_MST_APV_STATE = #{searchApvState}
                </if>                
            </if>
            <if test="searchStateNm != null and searchStateNm !=''">
                AND PRD_MST_DPL_YN = #{searchStateNm}
            </if>
        </where>
    </sql>
     <!-- 관리자 > 결합상품관리 > 상품 목록 개수 -->
    <select id="selectBasicProductListCount" parameterType="HashMap" resultType="Integer">
        /* BasicProduct.selectBasicProductListCount */
        SELECT COUNT(DISTINCT(TPM.PRD_MST_CD))
        FROM T_PRD_MST TPM, 
            C_PRD_MST CPM
        <include refid="productWhere"/>
        AND TPM.PRD_MST_CD=CPM.PRD_MST_CD (+)
    </select>
   
   <!-- 관리자 > 결합상품관리 > 상품 목록 -->
    <select id="selectBasicProductList" parameterType="HashMap" resultType="HashMap">
        /* BasicProduct.selectBasicProductList */
        SELECT
            RNUM,
            PRD_MST_CD,
            VDR_MST_IDX,
            CASE
                WHEN S2.VDR_MST_NM IS NOT NULL THEN S2.VDR_MST_NM
                WHEN S2.VDR_MST_NM IS NULL THEN (SELECT VDR_MST_NM FROM T_VDR_MST VM WHERE VM.VDR_MST_IDX = S2.VDR_MST_IDX )
            END AS VDR_MST_NM,
            PRD_MST_SPL_NM,
            PRD_MST_MD,
            PRD_MST_PRP_YN,
            PRD_MST_SPL_PRC,
            PRD_MST_REG_DT,
            PRD_MST_APV_DT,
            PRD_MST_APV_STATE,
            CASE 
                WHEN PRD_MST_APV_STATE = '${@common.code.Product@STATE_DISAPPROVAL}' THEN '${@common.code.Product@STATE_DISAPPROVAL_NM}'
                WHEN PRD_MST_APV_STATE = '${@common.code.Product@STATE_REJECT}' THEN '${@common.code.Product@STATE_REJECT_NM}'
                WHEN PRD_MST_APV_STATE = '${@common.code.Product@STATE_APPROVAL}' THEN '${@common.code.Product@STATE_APPROVAL_NM}'
                WHEN PRD_MST_APV_STATE = '${@common.code.Product@STATE_UNION}' THEN '${@common.code.Product@STATE_UNION_NM}'
            END AS PRD_MST_APV_STATE_NM,
            PRD_MST_NO,
            (select PRD_MST_DPL_YN from C_PRD_MST where PRD_MST_NO=S2.PRD_MST_NO) PRD_MST_DPL_YN
        FROM (
            SELECT S1.*,
                ROWNUM AS RNUM
            FROM (
                SELECT              
                   TPM.PRD_MST_CD,
                    TPM.VDR_MST_IDX,
                    TPM.PRD_MST_SPL_NM,
                    TPM.PRD_MST_MD,
                    TPM.PRD_MST_PRP_YN,
                    TPM.PRD_MST_SPL_PRC,
                    TPM.PRD_MST_REG_DT,
                    TPM.PRD_MST_APV_DT,
                    TPM.PRD_MST_APV_STATE,
                    MAX(CPM.PRD_MST_NO) PRD_MST_NO,
                    TPM.VDR_MST_NM
                FROM T_PRD_MST TPM, 
                C_PRD_MST CPM
                <include refid="productWhere"/>
                AND TPM.PRD_MST_CD=CPM.PRD_MST_CD (+)
                group by 
                    TPM.PRD_MST_CD,
                    TPM.VDR_MST_IDX,
                    TPM.PRD_MST_SPL_NM,
                    TPM.PRD_MST_MD,
                    TPM.PRD_MST_PRP_YN,
                    TPM.PRD_MST_SPL_PRC,
                    TPM.PRD_MST_REG_DT,
                    TPM.PRD_MST_APV_DT,
                    TPM.PRD_MST_APV_STATE,
                    TPM.VDR_MST_NM
                    <if test="searchOrderBy != null and searchOrderBy !=''">  ORDER BY
                        <choose>
                            <when test="searchOrderBy.equals(@common.code.Product@REG_SORT)"> TPM.PRD_MST_REG_DT DESC </when>
                            <when test="searchOrderBy.equals(@common.code.Product@UPD_SORT)"> TPM.PRD_MST_UPD_DT DESC </when>
                            <when test="searchOrderBy.equals(@common.code.Product@APV_SORT)"> TPM.PRD_MST_APV_DT DESC </when>
                            <when test="searchOrderBy.equals(@common.code.Product@UNI_SORT)"> TPM.PRD_MST_UNI_DT DESC </when>
                            <otherwise> TPM.PRD_MST_CD DESC</otherwise>
                        </choose> 
                    </if>
            ) S1
            <if test="endNum != null and endNum != ''">
            WHERE ROWNUM <![CDATA[<=]]> #{endNum}
            </if>
        ) S2
        <if test="startNum != null and startNum != ''">
        WHERE S2.RNUM <![CDATA[>=]]> #{startNum}
        </if>
    </select>
    
   <!-- 관리자 > 결합상품관리 > 상품 목록 -->
    <select id="selectBasicProductOption" parameterType="HashMap" resultType="HashMap">
        /* BasicProduct.selectBasicProductOption */
        SELECT 
            PRD_MST_CD,
            PRD_OPT_IDX,
            PRD_OPT_DTL
        FROM T_PRD_OPT
        WHERE PRD_MST_CD = #{PRD_MST_CD}
        ORDER BY PRD_OPT_IDX ASC
    </select>    
    
   <!-- 관리자 > 결합상품관리 > 거절사유보기 -->
    <select id="selectProductRejectInfo" parameterType="HashMap" resultType="HashMap">
        /* BasicProduct.selectProductRejectInfo */
        SELECT
            PRD_MST_REG_DT,
            PRD_MST_SPL_NM,
            PRD_MST_MD,
            PRD_MST_SPL_PRC,
            PRD_MST_APV_STATE,
            PRD_MST_RFS_RSN,
            PRD_MST_APV_ID,
            PRD_MST_APV_DT,
            (SELECT ADM_MST_NM FROM T_ADM_MST WHERE ADM_MST_ID = PRD_MST_APV_ID) AS PRD_MST_APV_NM
        FROM T_PRD_MST PM
        WHERE PRD_MST_CD = #{PRD_MST_CD}
    </select>

    <!-- 관리자 > 결합상품관리 > 승인하기 -->
    <update id="updateProductApproval" parameterType="HashMap">
        /* BasicProduct.updateProductApproval */
        UPDATE T_PRD_MST SET
            PRD_MST_APV_STATE = NVL(#{PRD_MST_APV_STATE}, '${@common.code.Product@STATE_APPROVAL}'),
            PRD_MST_APV_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
            PRD_MST_APV_ID = #{PRD_MST_APV_ID},
            PRD_MST_APV_IP = #{PRD_MST_APV_IP},
            VDR_MST_NM = #{VDR_MST_NM}
        WHERE PRD_MST_CD = #{PRD_MST_CD}
    </update>  
    
    <!-- 상품스펙 마스터 채번 -->
    <select id="selectProductCd" parameterType="hashMap" resultType="String">
        /* BasicProduct.selectProductCd */
        SELECT '${@common.code.Product@PRD_CD}' || TO_CHAR(SYSDATE, 'YYYYMMDD') || LPAD(SEQ_PRD_MST_CD.NEXTVAL ,4,'0')
        FROM DUAL
    </select> 
    
    <!-- 결합상품마스터 채번 -->
    <select id="selectProductNo" parameterType="hashMap" resultType="String">
        /* BasicProduct.selectProductNo */
        SELECT #{PRD_MST_CD} || LPAD(SEQ_PRD_MST_CD.NEXTVAL ,4,'0')
        FROM DUAL
    </select>     
    
    <!-- 관리자 > 결합상품관리 > 미승인상품등록 -->
    <insert id="insertProductDisapproval" parameterType="HashMap">
        /* BasicProduct.insertProductDisapproval */
        INSERT INTO T_PRD_MST (
            PRD_MST_CD,
            VDR_MST_IDX,
            PRD_MST_SPL_NM,
            PRD_MST_MD,
            PRD_MST_SPL_PRC,
            PRD_MST_OPT_YN,
            PRD_MST_OPT_NM,
            PRD_MST_PRP_YN,
            PRD_MST_APV_STATE,
            PRD_MST_RDP_TXT,
            PRD_MST_NTC_DSC,
            PRD_MST_DLV_DSC,
            PRD_MST_PC_YTB,
            PRD_MST_MB_YTB,
            PRD_MST_PC_DTL_DSC,
            PRD_MST_MB_DTL_DSC,
            PRD_MST_NFI_IDX,
            PRD_MST_NFI_INF1,
            PRD_MST_NFI_INF2,
            PRD_MST_NFI_INF3,
            PRD_MST_NFI_INF4,
            PRD_MST_NFI_INF5,
            PRD_MST_NFI_INF6,
            PRD_MST_NFI_INF7,
            PRD_MST_NFI_INF8,
            PRD_MST_NFI_INF9,
            PRD_MST_NFI_INF10,
            PRD_MST_NFI_INF11,
            PRD_MST_NFI_INF12,
            PRD_MST_NFI_INF13,
            PRD_MST_NFI_INF14,
            PRD_MST_REG_DT,
            PRD_MST_REG_IP,
            PRD_MST_REG_ID,
            VDR_MST_NM
        ) VALUES(
            #{PRD_MST_CD},
            #{VDR_MST_IDX},
            #{PRD_MST_SPL_NM},
            #{PRD_MST_MD},
            NVL(#{PRD_MST_SPL_PRC}, 0),
            #{PRD_MST_OPT_YN},
            #{PRD_MST_OPT_NM},
            #{PRD_MST_PRP_YN},
            '${@common.code.Product@STATE_DISAPPROVAL}',
            #{PRD_MST_RDP_TXT},
            #{PRD_MST_NTC_DSC},
            #{PRD_MST_DLV_DSC},
            #{PRD_MST_PC_YTB},
            #{PRD_MST_MB_YTB},
            #{PRD_MST_PC_DTL_DSC},
            #{PRD_MST_MB_DTL_DSC},
            #{PRD_MST_NFI_IDX},
            #{PRD_MST_NFI_INF1},
            #{PRD_MST_NFI_INF2},
            #{PRD_MST_NFI_INF3},
            #{PRD_MST_NFI_INF4},
            #{PRD_MST_NFI_INF5},
            #{PRD_MST_NFI_INF6},
            #{PRD_MST_NFI_INF7},
            #{PRD_MST_NFI_INF8},
            #{PRD_MST_NFI_INF9},
            #{PRD_MST_NFI_INF10},
            #{PRD_MST_NFI_INF11},
            #{PRD_MST_NFI_INF12},
            #{PRD_MST_NFI_INF13},
            #{PRD_MST_NFI_INF14},
            TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
            #{PRD_MST_REG_IP},
            #{PRD_MST_REG_ID},
            #{VDR_MST_NM}
        )
    </insert>
    
    <!-- 관리자 > 결합상품관리 > 미승인상품옵션등록 -->
    <insert id="insertProductOption" parameterType="HashMap">
        /* BasicProduct.insertProductOption */
        INSERT INTO T_PRD_OPT (
            PRD_OPT_IDX,
            PRD_MST_CD,
            PRD_OPT_DTL
        ) VALUES(
            SEQ_PRD_OPT_IDX.NEXTVAL,
            #{PRD_MST_CD},
            #{PRD_OPT_DTL}
        )
    </insert>
    
    <!-- 관리자 > 결합상품관리 > 미승인상품옵션수정 -->
    <update id="updateProductOption" parameterType="HashMap">
        /* BasicProduct.updateProductOption */
        UPDATE T_PRD_OPT SET
            PRD_OPT_DTL = #{PRD_OPT_DTL}
        WHERE PRD_OPT_IDX = #{PRD_OPT_IDX}
    </update>
    
    <!-- 관리자 > 결합상품관리 > 미승인상품옵션삭제 -->
    <delete id="deleteProductOption" parameterType="HashMap">
        /* BasicProduct.deleteProductOption */
        DELETE FROM T_PRD_OPT WHERE PRD_MST_CD = #{PRD_MST_CD}
    </delete>
    
    <!-- 관리자 > 상품관리 > 상품상세 -->
    <resultMap id="resultProductInfo" type="HashMap">
        <result property="PRD_MST_CD" column="PRD_MST_CD"/>
        <result property="VDR_MST_IDX" column="VDR_MST_IDX"/>
        <result property="VDR_MST_NM" column="VDR_MST_NM"/>
        <result property="PRD_MST_SPL_NM" column="PRD_MST_SPL_NM"/>
        <result property="PRD_MST_MD" column="PRD_MST_MD"/>
        <result property="PRD_MST_SPL_PRC" column="PRD_MST_SPL_PRC"/>
        <result property="PRD_MST_OPT_YN" column="PRD_MST_OPT_YN"/>
        <result property="PRD_MST_OPT_NM" column="PRD_MST_OPT_NM"/>
        <result property="PRD_MST_PRP_YN" column="PRD_MST_PRP_YN"/>
        <result property="PRD_MST_APV_STATE" column="PRD_MST_APV_STATE"/>
        <result property="PRD_MST_RFS_RSN" column="PRD_MST_RFS_RSN"/>
        <result property="PRD_MST_NTC_DSC" column="PRD_MST_NTC_DSC" jdbcType="CLOB" javaType="java.lang.String"/>
        <result property="PRD_MST_PC_YTB" column="PRD_MST_PC_YTB" jdbcType="CLOB" javaType="java.lang.String"/>
        <result property="PRD_MST_MB_YTB" column="PRD_MST_MB_YTB" jdbcType="CLOB" javaType="java.lang.String"/>
        <result property="PRD_MST_DLV_DSC" column="PRD_MST_DLV_DSC" jdbcType="CLOB" javaType="java.lang.String"/>
        <result property="PRD_MST_PC_DTL_DSC" column="PRD_MST_PC_DTL_DSC" jdbcType="CLOB" javaType="java.lang.String"/>
        <result property="PRD_MST_MB_DTL_DSC" column="PRD_MST_MB_DTL_DSC" jdbcType="CLOB" javaType="java.lang.String"/>
        <result property="PRD_MST_NFI_IDX" column="PRD_MST_NFI_IDX"/>
        <result property="PRD_MST_NFI_INF1" column="PRD_MST_NFI_INF1"/>
        <result property="PRD_MST_NFI_INF2" column="PRD_MST_NFI_INF2"/>
        <result property="PRD_MST_NFI_INF3" column="PRD_MST_NFI_INF3"/>
        <result property="PRD_MST_NFI_INF4" column="PRD_MST_NFI_INF4"/>
        <result property="PRD_MST_NFI_INF5" column="PRD_MST_NFI_INF5"/>
        <result property="PRD_MST_NFI_INF6" column="PRD_MST_NFI_INF6"/>
        <result property="PRD_MST_NFI_INF7" column="PRD_MST_NFI_INF7"/>
        <result property="PRD_MST_NFI_INF8" column="PRD_MST_NFI_INF8"/>
        <result property="PRD_MST_NFI_INF9" column="PRD_MST_NFI_INF9"/>
        <result property="PRD_MST_NFI_INF10" column="PRD_MST_NFI_INF10"/>
        <result property="PRD_MST_NFI_INF11" column="PRD_MST_NFI_INF11"/>
        <result property="PRD_MST_NFI_INF12" column="PRD_MST_NFI_INF12"/>
        <result property="PRD_MST_NFI_INF13" column="PRD_MST_NFI_INF13"/>
        <result property="PRD_MST_NFI_INF14" column="PRD_MST_NFI_INF14"/>
        <result property="PRD_MST_RDP_TXT" column="PRD_MST_RDP_TXT"/>
        <result property="PRD_MST_REG_DT" column="PRD_MST_REG_DT"/>
        <result property="PRD_MST_REG_IP" column="PRD_MST_REG_IP"/>
        <result property="PRD_MST_REG_ID" column="PRD_MST_REG_ID"/>
        <result property="PRD_MST_REG_NM" column="PRD_MST_REG_NM"/>
        <result property="PRD_MST_UPD_DT" column="PRD_MST_UPD_DT"/>
        <result property="PRD_MST_UPD_IP" column="PRD_MST_UPD_IP"/>
        <result property="PRD_MST_UPD_ID" column="PRD_MST_UPD_ID"/>
        <result property="PRD_MST_UPD_NM" column="PRD_MST_UPD_NM"/>
        <result property="PRD_MST_APV_DT" column="PRD_MST_APV_DT"/>
        <result property="PRD_MST_APV_IP" column="PRD_MST_APV_IP"/>
        <result property="PRD_MST_APV_ID" column="PRD_MST_APV_ID"/>
        <result property="PRD_MST_APV_NM" column="PRD_MST_APV_NM"/>        
    </resultMap>
    <select id="selectBasicProductInfo" parameterType="HashMap" resultMap="resultProductInfo">
        /* BasicProduct.selectBasicProductInfo */
        SELECT 
            PRD_MST_CD,
            VDR_MST_IDX,
            (SELECT VDR_MST_NM FROM T_VDR_MST VM WHERE VM.VDR_MST_IDX = PM.VDR_MST_IDX) AS VDR_MST_NM,
            CASE
                WHEN VDR_MST_NM IS NULL THEN (SELECT VDR_MST_NM FROM T_VDR_MST VM WHERE VM.VDR_MST_IDX = PM.VDR_MST_IDX)
                WHEN VDR_MST_NM IS NOT NULL THEN VDR_MST_NM
            END AS VDR_MST_NM_DIS,
            PRD_MST_SPL_NM,
            PRD_MST_MD,
            PRD_MST_PRP_YN,
            PRD_MST_SPL_PRC,
            PRD_MST_OPT_YN,
            PRD_MST_OPT_NM,
            PRD_MST_APV_STATE,
            PRD_MST_RFS_RSN,
            PRD_MST_NTC_DSC,
            PRD_MST_PC_YTB,
            PRD_MST_MB_YTB,
            PRD_MST_DLV_DSC,
            PRD_MST_PC_DTL_DSC,
            PRD_MST_MB_DTL_DSC,
            PRD_MST_NFI_IDX,
            PRD_MST_NFI_INF1,
            PRD_MST_NFI_INF2,
            PRD_MST_NFI_INF3,
            PRD_MST_NFI_INF4,
            PRD_MST_NFI_INF5,
            PRD_MST_NFI_INF6,
            PRD_MST_NFI_INF7,
            PRD_MST_NFI_INF8,
            PRD_MST_NFI_INF9,
            PRD_MST_NFI_INF10,
            PRD_MST_NFI_INF11,
            PRD_MST_NFI_INF12,
            PRD_MST_NFI_INF13,
            PRD_MST_NFI_INF14,
            PRD_MST_RDP_TXT,
            PRD_MST_REG_DT,
            PRD_MST_REG_IP,
            PRD_MST_REG_ID,
            (SELECT ADM_MST_NM FROM T_ADM_MST WHERE ADM_MST_ID = PRD_MST_REG_ID) AS PRD_MST_REG_NM,
            PRD_MST_UPD_DT,
            PRD_MST_UPD_IP,
            PRD_MST_UPD_ID,
            (SELECT ADM_MST_NM FROM T_ADM_MST WHERE ADM_MST_ID = PRD_MST_UPD_ID) AS PRD_MST_UPD_NM,
            PRD_MST_APV_DT,
            PRD_MST_APV_IP,
            PRD_MST_APV_ID,
            (SELECT ADM_MST_NM FROM T_ADM_MST WHERE ADM_MST_ID = PRD_MST_APV_ID) AS PRD_MST_APV_NM            
        FROM T_PRD_MST PM
        WHERE PRD_MST_CD = #{PRD_MST_CD}
    </select> 
    
    <!-- 관리자 > 결합상품관리 > 미승인, 승인 상품업데이트 -->
    <update id="updateProductDisapproval" parameterType="HashMap">
    /* BasicProduct.updateProductDisapproval */
        UPDATE T_PRD_MST SET
            <if test="PRD_MST_SPL_NM != null and PRD_MST_SPL_NM != ''"> 
                PRD_MST_SPL_NM = #{PRD_MST_SPL_NM},
            </if>
            <if test="PRD_MST_MD != null and PRD_MST_MD != ''">
                PRD_MST_MD = #{PRD_MST_MD},
            </if>
            <if test="PRD_MST_SPL_PRC != null and PRD_MST_SPL_PRC != ''">
                PRD_MST_SPL_PRC = #{PRD_MST_SPL_PRC},
            </if>
            <if test="PRD_MST_OPT_YN != null and PRD_MST_OPT_YN != ''">
                PRD_MST_OPT_YN = #{PRD_MST_OPT_YN},
            </if>
            <if test="PRD_MST_PRP_YN != null and PRD_MST_PRP_YN != ''">
                PRD_MST_PRP_YN = #{PRD_MST_PRP_YN},
            </if>
            <if test="PRD_MST_OPT_NM != null and PRD_MST_OPT_NM != ''">
                PRD_MST_OPT_NM = #{PRD_MST_OPT_NM},
            </if>
            <if test="PRD_MST_APV_STATE != null and PRD_MST_APV_STATE != ''">            
                PRD_MST_APV_STATE = #{PRD_MST_APV_STATE},
            </if> 
            <if test="PRD_MST_RFS_RSN != null and PRD_MST_RFS_RSN != ''">
                PRD_MST_RFS_RSN = #{PRD_MST_RFS_RSN},
            </if>
            PRD_MST_NTC_DSC = #{PRD_MST_NTC_DSC},
            PRD_MST_DLV_DSC = #{PRD_MST_DLV_DSC},
            PRD_MST_PC_YTB = #{PRD_MST_PC_YTB},
            PRD_MST_MB_YTB = #{PRD_MST_MB_YTB},
            PRD_MST_PC_DTL_DSC = #{PRD_MST_PC_DTL_DSC},
            PRD_MST_MB_DTL_DSC = #{PRD_MST_MB_DTL_DSC},
            PRD_MST_NFI_IDX = #{PRD_MST_NFI_IDX},
            PRD_MST_NFI_INF1 = #{PRD_MST_NFI_INF1},
            PRD_MST_NFI_INF2 = #{PRD_MST_NFI_INF2},
            PRD_MST_NFI_INF3 = #{PRD_MST_NFI_INF3},
            PRD_MST_NFI_INF4 = #{PRD_MST_NFI_INF4},
            PRD_MST_NFI_INF5 = #{PRD_MST_NFI_INF5},
            PRD_MST_NFI_INF6 = #{PRD_MST_NFI_INF6},
            PRD_MST_NFI_INF7 = #{PRD_MST_NFI_INF7},
            PRD_MST_NFI_INF8 = #{PRD_MST_NFI_INF8},
            PRD_MST_NFI_INF9 = #{PRD_MST_NFI_INF9},
            PRD_MST_NFI_INF10 = #{PRD_MST_NFI_INF10},
            PRD_MST_NFI_INF11 = #{PRD_MST_NFI_INF11},
            PRD_MST_NFI_INF12 = #{PRD_MST_NFI_INF12},
            PRD_MST_NFI_INF13 = #{PRD_MST_NFI_INF13},
            PRD_MST_NFI_INF14 = #{PRD_MST_NFI_INF14},
            <if test="PRD_MST_APV_ID != null and PRD_MST_APV_ID != ''">  
                PRD_MST_APV_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
                PRD_MST_APV_ID = #{PRD_MST_APV_ID},
                PRD_MST_APV_IP = #{PRD_MST_APV_IP},
            </if>        
            PRD_MST_UPD_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
            PRD_MST_UPD_ID = #{PRD_MST_UPD_ID},
            PRD_MST_UPD_IP = #{PRD_MST_UPD_IP},
            VDR_MST_NM = #{VDR_MST_NM}               
        WHERE PRD_MST_CD = #{PRD_MST_CD}
    </update>
    
    <!-- 관리자 > 결합상품관리 > 상품업데이트 -->
    <update id="updateProductUnionEdit" parameterType="HashMap">
    /* BasicProduct.updateProductUnionEdit */
        UPDATE T_PRD_MST SET
            <if test="PRD_MST_SPL_NM != null and PRD_MST_SPL_NM != ''"> 
                PRD_MST_SPL_NM = #{PRD_MST_SPL_NM},
            </if>
            <if test="PRD_MST_MD != null and PRD_MST_MD != ''">
                PRD_MST_MD = #{PRD_MST_MD},
            </if>
            <if test="PRD_MST_SPL_PRC != null and PRD_MST_SPL_PRC != ''">
                PRD_MST_SPL_PRC = #{PRD_MST_SPL_PRC},
            </if>
            <if test="PRD_MST_OPT_YN != null and PRD_MST_OPT_YN != ''">
                PRD_MST_OPT_YN = #{PRD_MST_OPT_YN},
            </if>
            <if test="PRD_MST_PRP_YN != null and PRD_MST_PRP_YN != ''">
                PRD_MST_PRP_YN = #{PRD_MST_PRP_YN},
            </if>
            <if test="PRD_MST_OPT_NM != null and PRD_MST_OPT_NM != ''">
                PRD_MST_OPT_NM = #{PRD_MST_OPT_NM},
            </if>
            <if test="PRD_MST_APV_STATE != null and PRD_MST_APV_STATE != ''">            
                PRD_MST_APV_STATE = #{PRD_MST_APV_STATE},
            </if> 
            <if test="PRD_MST_RFS_RSN != null and PRD_MST_RFS_RSN != ''">
                PRD_MST_RFS_RSN = #{PRD_MST_RFS_RSN},
            </if>
            PRD_MST_RDP_TXT = #{PRD_MST_RDP_TXT},
            PRD_MST_NTC_DSC = #{PRD_MST_NTC_DSC},
            PRD_MST_DLV_DSC = #{PRD_MST_DLV_DSC},
            PRD_MST_PC_YTB = #{PRD_MST_PC_YTB},
            PRD_MST_MB_YTB = #{PRD_MST_MB_YTB},
            PRD_MST_PC_DTL_DSC = #{PRD_MST_PC_DTL_DSC},
            PRD_MST_MB_DTL_DSC = #{PRD_MST_MB_DTL_DSC},
            PRD_MST_NFI_IDX = #{PRD_MST_NFI_IDX},
            PRD_MST_NFI_INF1 = #{PRD_MST_NFI_INF1},
            PRD_MST_NFI_INF2 = #{PRD_MST_NFI_INF2},
            PRD_MST_NFI_INF3 = #{PRD_MST_NFI_INF3},
            PRD_MST_NFI_INF4 = #{PRD_MST_NFI_INF4},
            PRD_MST_NFI_INF5 = #{PRD_MST_NFI_INF5},
            PRD_MST_NFI_INF6 = #{PRD_MST_NFI_INF6},
            PRD_MST_NFI_INF7 = #{PRD_MST_NFI_INF7},
            PRD_MST_NFI_INF8 = #{PRD_MST_NFI_INF8},
            PRD_MST_NFI_INF9 = #{PRD_MST_NFI_INF9},
            PRD_MST_NFI_INF10 = #{PRD_MST_NFI_INF10},
            PRD_MST_NFI_INF11 = #{PRD_MST_NFI_INF11},
            PRD_MST_NFI_INF12 = #{PRD_MST_NFI_INF12},
            PRD_MST_NFI_INF13 = #{PRD_MST_NFI_INF13},
            PRD_MST_NFI_INF14 = #{PRD_MST_NFI_INF14},
            <if test="PRD_MST_APV_ID != null and PRD_MST_APV_ID != ''">  
                PRD_MST_APV_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
                PRD_MST_APV_ID = #{PRD_MST_APV_ID},
                PRD_MST_APV_IP = #{PRD_MST_APV_IP},
            </if>        
            PRD_MST_UPD_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
            PRD_MST_UPD_ID = #{PRD_MST_UPD_ID},
            PRD_MST_UPD_IP = #{PRD_MST_UPD_IP},
            VDR_MST_NM = #{VDR_MST_NM}                
        WHERE PRD_MST_CD = #{PRD_MST_CD}
    </update>   

    <!-- 관리자 > 결합상품관리 > 재승인요청 -->
    <update id="updateProductApprovalRequest" parameterType="HashMap">
        /* BasicProduct.updateProductApprovalRequest */
        UPDATE T_PRD_MST SET
            PRD_MST_APV_STATE = '${@common.code.Product@STATE_DISAPPROVAL}',
            PRD_MST_RFS_RSN = NULL,
            PRD_MST_UPD_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
            PRD_MST_UPD_ID = #{PRD_MST_UPD_ID},
            PRD_MST_UPD_IP = #{PRD_MST_UPD_IP},
            PRD_MST_APV_DT = NULL,
            PRD_MST_APV_ID = NULL,
            PRD_MST_APV_IP = NULL,
            VDR_MST_NM = #{VDR_MST_NM}            
        WHERE PRD_MST_CD = #{PRD_MST_CD}
    </update>  
    
    <!-- 관리자 > 상품관리 > 결합상품상세 -->
    <select id="selectUnionProductInfo" parameterType="HashMap" resultType="HashMap">
        /* BasicProduct.selectUnionProductInfo */
        SELECT
            CPM.PRD_MST_NO,
            PRD_MST_CD,
            (SELECT PRD_CTG_UP_IDX FROM T_PRD_CTG PC WHERE PC.PRD_CTG_IDX = CPM.PRD_CTG_IDX) AS PRD_CTG_IDX1,
            PRD_CTG_IDX AS PRD_CTG_IDX2,
            PRD_CTG_IDX,
            CPM.PROD_CD,
            CPM.PROD_KIND,
            CPM.MODEL_CD,
            MODEL_CL_NM,
            PROD_AMT,
            MON_PAY_AMT,
            EXPR_NO,
            REL_AMT,
            REL_CNT,
            PRD_MST_NM,
            PRD_MST_SEL_TXT,
            PRD_MST_ST_DT,
            PRD_MST_ED_DT,
            PRD_MST_KWD,
            PRD_MST_DPL_YN,
            PRD_MST_QNA_YN,
            PRD_MST_REV_YN,
            PRD_MST_TYPE,
            (SELECT CMN_COM_NM FROM T_CMM_COM WHERE CMN_COM_IDX = PRD_MST_TYPE) AS PRD_MST_TYPE_NM,
            PRD_MST_PRP_YN,
            PRD_MST_REC_TXT_YN,
            PRD_MST_BND_YN,
            PRD_MST_BND_ID,
            PRD_MST_JOIN_LMT,
            PRD_MST_MAIN_CTRT,
            PRD_MST_SPT_TXT,
            PRD_MST_RTL_PAY,
            PRD_MST_ISTM_MTH,
            PRD_MST_ISTM_SPT_PAY,
            PRD_MST_DSP_SVC,
            PRD_MST_RLT_YN,
            PRD_MST_SRT,
            PRD_MST_DEL_YN,
            PRD_MST_HITS,
            PRD_MST_CMS_CD,
            PRD_MST_RDP_CMS_CD, --DEPRECATE
            PRD_MST_RDP_CMS, --DEPRECATE
            PRD_MST_RDP_DVD_PAY, --DEPRECATE
            PRD_MST_RDP_DVD_CNT, --DEPRECATE
            CPMRC.PRC_RDP_CMS_CD,
            CPMRC.PRC_RDP_CMS,
            CPMRC.PRC_RDP_DVD_PAY,
            CPMRC.PRC_RDP_DVD_CNT,
            CPMRC1.PRC_RDP_CMS_CD AS PRC_RDP_P_CMS_CD,
            CPMRC1.PRC_RDP_CMS AS PRC_RDP_P_CMS,
            CPMRC1.PRC_RDP_DVD_PAY AS PRC_RDP_P_DVD_PAY,
            CPMRC1.PRC_RDP_DVD_CNT AS PRC_RDP_P_DVD_CNT,
            PRD_MST_IRG_YN,
            PRD_MST_PAY_CNT1,
            PRD_MST_PAY_AMT1,
            PRD_MST_PAY_CNT2,
            PRD_MST_PAY_AMT2,
            PRD_MST_PAY_CNT3,
            PRD_MST_PAY_AMT3,
            CPM.PRD_MST_REG_DT,
            PRD_MST_REG_IP,
            PRD_MST_REG_ID,
            (SELECT ADM_MST_NM FROM T_ADM_MST WHERE ADM_MST_ID = PRD_MST_REG_ID) AS PRD_MST_REG_NM,
            CPM.PRD_MST_UPD_DT,
            PRD_MST_UPD_IP,
            PRD_MST_UPD_ID,
            (SELECT ADM_MST_NM FROM T_ADM_MST WHERE ADM_MST_ID = PRD_MST_UPD_ID) AS PRD_MST_UPD_NM
        FROM C_PRD_MST CPM
        INNER JOIN V_PRD_MST VPM ON CPM.PROD_CD = VPM.PROD_CD
            AND CPM.PROD_KIND = VPM.PROD_KIND
            AND CPM.MODEL_CD = VPM.MODEL_CD
        LEFT OUTER JOIN  C_PRD_MST_RDP_CMS CPMRC ON CPMRC.PRD_MST_NO = CPM.PRD_MST_NO AND  CPMRC.PRC_PAY_CLS = ${@common.code.Code@PLANNER_PAY_CLASS_LEGAL_PERSON} --법인
        LEFT OUTER JOIN  C_PRD_MST_RDP_CMS CPMRC1 ON CPMRC1.PRD_MST_NO = CPM.PRD_MST_NO AND  CPMRC1.PRC_PAY_CLS = ${@common.code.Code@PLANNER_PAY_CLASS_PRIVATE} --개인
        WHERE CPM.PRD_MST_NO = #{PRD_MST_NO}
    </select>
    
    <!-- 관리자 > 결합상품관리 > 결합상품등록 -->
    <insert id="insertProductUnion" parameterType="HashMap">
        /* BasicProduct.insertProductUnion */
        INSERT INTO C_PRD_MST (
            PRD_MST_NO,
            PRD_MST_CD,
            PRD_CTG_IDX,
            PROD_CD,
            PROD_KIND,
            MODEL_CD,
            PRD_MST_NM,
            PRD_MST_SEL_TXT,
            PRD_MST_ST_DT,
            PRD_MST_ED_DT,
            PRD_MST_KWD,
            PRD_MST_DPL_YN,
            PRD_MST_QNA_YN,
            PRD_MST_REV_YN,
            PRD_MST_TYPE,
            PRD_MST_PRP_YN,
            PRD_MST_BND_YN,
            PRD_MST_BND_ID,
            PRD_MST_JOIN_LMT,
            PRD_MST_MAIN_CTRT,
            PRD_MST_SPT_TXT,
            PRD_MST_RTL_PAY,
            PRD_MST_ISTM_MTH,
            PRD_MST_ISTM_SPT_PAY,
            PRD_MST_DSP_SVC,
            PRD_MST_RLT_YN,
            PRD_MST_SRT,
            PRD_MST_DEL_YN,
            PRD_MST_HITS,
            PRD_MST_CMS_CD,
            PRD_MST_RDP_CMS_CD,
            PRD_MST_RDP_CMS,
            PRD_MST_RDP_DVD_PAY,
            PRD_MST_RDP_DVD_CNT,
            PRD_MST_IRG_YN,
            PRD_MST_PAY_CNT1,
            PRD_MST_PAY_AMT1,
            PRD_MST_PAY_CNT2,
            PRD_MST_PAY_AMT2,
            PRD_MST_PAY_CNT3,
            PRD_MST_PAY_AMT3,
            PRD_MST_REG_DT,
            PRD_MST_REG_IP,
            PRD_MST_REG_ID,
            VDR_MST_NM
        ) VALUES(
            #{PRD_MST_NO},
            #{PRD_MST_CD},
            #{PRD_CTG_IDX},
            #{PROD_CD},
            #{PROD_KIND},
            #{MODEL_CD},            
            #{PRD_MST_NM},
            #{PRD_MST_SEL_TXT},
            REPLACE(#{PRD_MST_ST_DT},'-', ''),
            REPLACE(#{PRD_MST_ED_DT},'-', ''),
            #{PRD_MST_KWD},
            #{PRD_MST_DPL_YN},
            #{PRD_MST_QNA_YN},
            #{PRD_MST_REV_YN},
            #{PRD_MST_TYPE},
            #{PRD_MST_PRP_YN},
            #{PRD_MST_BND_YN},
            #{PRD_MST_BND_ID},
            #{PRD_MST_JOIN_LMT},
            #{PRD_MST_MAIN_CTRT},
            #{PRD_MST_SPT_TXT},
            #{PRD_MST_RTL_PAY},
            #{PRD_MST_ISTM_MTH},
            #{PRD_MST_ISTM_SPT_PAY},
            #{PRD_MST_DSP_SVC},
            #{PRD_MST_RLT_YN},
            #{PRD_MST_SRT},
            NVL(#{PRD_MST_DEL_YN}, 'N'),
            0,
            #{PRD_MST_CMS_CD},
            #{PRD_MST_RDP_CMS_CD},
            #{PRD_MST_RDP_CMS},
            #{PRD_MST_RDP_DVD_PAY},
            #{PRD_MST_RDP_DVD_CNT},
            #{PRD_MST_IRG_YN},
            #{PRD_MST_PAY_CNT1},
            #{PRD_MST_PAY_AMT1},
            #{PRD_MST_PAY_CNT2},
            #{PRD_MST_PAY_AMT2},
            #{PRD_MST_PAY_CNT3},
            #{PRD_MST_PAY_AMT3},
            TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
            #{PRD_MST_REG_IP},
            #{PRD_MST_REG_ID},
            #{VDR_MST_NM}
        )
    </insert>


    <!-- 관리자 > 결합상품관리 > 결합상품등록 -->
    <insert id="insertProductUnionCMS" parameterType="HashMap">
        /* BasicProduct.insertProductUnionCMS */
        MERGE INTO C_PRD_MST_RDP_CMS
            USING DUAL
            ON (PRD_MST_NO = #{PRD_MST_NO} AND PRC_PAY_CLS = #{PRC_PAY_CLS})
            WHEN MATCHED THEN
                UPDATE SET
                PRC_RDP_CMS_CD = #{PRC_RDP_CMS_CD}
                , PRC_RDP_CMS = #{PRC_RDP_CMS}
                , PRC_RDP_DVD_PAY = #{PRC_RDP_DVD_PAY}
                , PRC_RDP_DVD_CNT = #{PRC_RDP_DVD_CNT}
                , PRC_UPD_IP = #{PRD_MST_REG_IP}
                , PRC_UPD_ID = #{PRD_MST_REG_ID}
                    , PRC_UPD_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
            WHEN NOT MATCHED THEN
                INSERT  (PRD_MST_NO, PRC_PAY_CLS, PRC_RDP_CMS_CD, PRC_RDP_CMS, PRC_RDP_DVD_PAY, PRC_RDP_DVD_CNT, PRC_UPD_DT, PRC_UPD_IP, PRC_UPD_ID)
                VALUES( #{PRD_MST_NO}, #{PRC_PAY_CLS}, #{PRC_RDP_CMS_CD}, #{PRC_RDP_CMS}, #{PRC_RDP_DVD_PAY}, #{PRC_RDP_DVD_CNT},  TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'), #{PRD_MST_REG_IP}, #{PRD_MST_REG_ID} )
    </insert>

    <!-- 관리자 > 결합상품관리 > 결합 관련 상품등록 -->
    <insert id="insertRelatedProduct" parameterType="HashMap">
        /* BasicProduct.insertRelatedProduct */
        <selectKey keyProperty="PRD_RLT_IDX" keyColumn="PRD_RLT_IDX" resultType="Integer" order="BEFORE">
            SELECT SEQ_PRD_RLT_IDX.NEXTVAL AS PRD_RLT_IDX FROM DUAL
        </selectKey>
        INSERT INTO T_PRD_RLT (
            PRD_RLT_IDX,
            PRD_MST_NO,
            PRD_RLT_MST_NO
        ) VALUES(
            #{PRD_RLT_IDX},
            #{PRD_MST_NO},
            #{PRD_RLT_MST_NO}
        )
    </insert>

    <!-- 관리자 > 결합상품관리 > 결합관련상품삭제 -->
    <delete id="deleteRelatedProduct" parameterType="HashMap">
        /* BasicProduct.deleteProductOption */
        DELETE FROM T_PRD_RLT WHERE PRD_MST_NO = #{PRD_MST_NO}
    </delete>

    <!-- 관리자 > 결합상품관리 > 결합 관련 상품등록 -->
    <select id="selectRelatedProduct" parameterType="HashMap" resultType="HashMap">
        /* BasicProduct.selectRelatedProduct */
        SELECT 
            CPM.PRD_MST_NO,
            CPM.PRD_MST_TYPE,
            CPM.PRD_MST_NM,
            VPM.PROD_AMT,
            VPM.PROD_CD,
            VPM.MODEL_CL_NM,
            VPM.MODEL_NM,
            TPM.PRD_MST_SPL_NM,
            TPM.PRD_MST_MD,
            CPM.PRD_MST_DPL_YN,
            (SELECT CMN_COM_NM FROM T_CMM_COM WHERE CMN_COM_IDX = PRD_MST_TYPE) AS PRD_MST_TYPE_NM,
            CASE 
                WHEN PRD_MST_DPL_YN = '${@common.code.Product@DISPLAY_SHOW}' THEN '${@common.code.Product@DISPLAY_SHOW_NM}'
                WHEN PRD_MST_DPL_YN = '${@common.code.Product@DISPLAY_HIDE}' THEN '${@common.code.Product@DISPLAY_HIDE_NM}'
                WHEN PRD_MST_DPL_YN = '${@common.code.Product@DISPLAY_SOLDOUT}' THEN '${@common.code.Product@DISPLAY_SOLDOUT_NM}'
            END AS PRD_MST_DPL_TXT
        FROM T_PRD_MST TPM, C_PRD_MST CPM, V_PRD_MST VPM, T_PRD_RLT TPR
        WHERE TPM.PRD_MST_CD = CPM.PRD_MST_CD
        AND CPM.PROD_CD = VPM.PROD_CD
        AND CPM.PROD_KIND = VPM.PROD_KIND
        AND CPM.MODEL_CD = VPM.MODEL_CD
        AND TPR.PRD_MST_NO = #{PRD_MST_NO}
        AND TPR.PRD_RLT_MST_NO = CPM.PRD_MST_NO
        ORDER BY TPR.PRD_RLT_IDX ASC
    </select> 
    
    <!-- 관리자 > 결합상품관리 > 결합상품업데이트 -->
    <update id="updateProductUnion" parameterType="HashMap">
    /* BasicProduct.updateProductUnion */
        UPDATE C_PRD_MST SET
            <if test="PRD_MST_NM != null and PRD_MST_NM != ''">
                PRD_MST_NM = #{PRD_MST_NM},
            </if>
                PRD_CTG_IDX = #{PRD_CTG_IDX},
            <if test="PRD_MST_SEL_TXT != null and PRD_MST_SEL_TXT != ''">
                PRD_MST_SEL_TXT = #{PRD_MST_SEL_TXT},
            </if>            
            PRD_MST_ST_DT = REPLACE(#{PRD_MST_ST_DT},'-', ''),
            PRD_MST_ED_DT = REPLACE(#{PRD_MST_ED_DT},'-', ''),
            <if test="PRD_MST_KWD != null and PRD_MST_KWD != ''">
                PRD_MST_KWD = #{PRD_MST_KWD},
            </if>
            PRD_MST_DPL_YN = #{PRD_MST_DPL_YN},
            PRD_MST_QNA_YN = #{PRD_MST_QNA_YN},
            PRD_MST_REV_YN = #{PRD_MST_REV_YN},
            PRD_MST_PRP_YN  = #{PRD_MST_PRP_YN},
            PRD_MST_JOIN_LMT = #{PRD_MST_JOIN_LMT},
            <if test="PRD_MST_DSP_SVC != null and PRD_MST_DSP_SVC != ''">
                PRD_MST_DSP_SVC = #{PRD_MST_DSP_SVC}, 
            </if>
            <if test="PRD_MST_SPT_TXT != null and PRD_MST_SPT_TXT != ''">
                PRD_MST_SPT_TXT = #{PRD_MST_SPT_TXT}, 
            </if>
            <if test="PRD_MST_RTL_PAY != null and PRD_MST_RTL_PAY != ''">
                PRD_MST_RTL_PAY = #{PRD_MST_RTL_PAY}, 
            </if>
            <if test="PRD_MST_MAIN_CTRT != null and PRD_MST_MAIN_CTRT != ''">
                PRD_MST_MAIN_CTRT = #{PRD_MST_MAIN_CTRT}, 
            </if>
            <if test="PRD_MST_RDP_CMS != null and PRD_MST_RDP_CMS != ''">
                PRD_MST_RDP_CMS = #{PRD_MST_RDP_CMS}, 
            </if>
            <if test="PRD_MST_RDP_DVD_PAY != null and PRD_MST_RDP_DVD_PAY != ''">
                PRD_MST_RDP_DVD_PAY = #{PRD_MST_RDP_DVD_PAY}, 
            </if>
            <if test="PRD_MST_RDP_DVD_CNT != null and PRD_MST_RDP_DVD_CNT != ''">
                PRD_MST_RDP_DVD_CNT = #{PRD_MST_RDP_DVD_CNT}, 
            </if>
            <if test="PRD_MST_BND_ID != null and PRD_MST_BND_ID != ''">
                PRD_MST_BND_ID = #{PRD_MST_BND_ID}, 
            </if>
            <if test="PRD_MST_REC_TXT_YN != null and PRD_MST_REC_TXT_YN != ''">
                PRD_MST_REC_TXT_YN = #{PRD_MST_REC_TXT_YN},
            </if>
            PRD_MST_RLT_YN = #{PRD_MST_RLT_YN},
            PRD_MST_UPD_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
            PRD_MST_UPD_ID = #{PRD_MST_UPD_ID},
            PRD_MST_UPD_IP = #{PRD_MST_UPD_IP},                
            VDR_MST_NM = #{VDR_MST_NM}                
        WHERE PRD_MST_NO = #{PRD_MST_NO}
    </update>
    
    <!-- 관리자 > 결합상품관리 > DLCC 마스터 상품업데이트 -->
    <update id="updateDlccProductMaster" parameterType="HashMap">
    /* BasicProduct.updateDlccProductMaster */
        UPDATE V_PRD_MST SET
            REL_AMT = #{REL_AMT},
            REL_CNT = #{REL_CNT},
            MON_REL_AMT =  TRUNC(#{REL_AMT}/#{REL_CNT}),
            PRD_MST_UPD_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
        WHERE PROD_CD = #{PROD_CD}
        AND PROD_KIND = #{PROD_KIND}
        AND MODEL_CD = #{MODEL_CD}
    </update>
    
    <!-- 관리자 > 결합상품관리 > DLCC 마스터 상품 추천 순서 수정 -->
    <update id="updateProductSuggest" parameterType="HashMap">
    /* BasicProduct.updateProductSuggest */
        /* BasicProduct.updateProductOption */
        UPDATE C_PRD_MST SET
            PRD_MST_SUGGEST = #{PRD_MST_SUGGEST}
        WHERE PRD_MST_NO = #{PRD_MST_NO}
    </update>



    <!-- 관리자 > 레디플래너 > 활동 플래너 조건절 -->
    <sql id="prdPlannerWhere">
        <bind name="PLANNER_STATE_ACTIVE" value="@common.code.Code@PLANNER_STATE_ACTIVE"/>
        <bind name="PLANNER_STATE_STOP" value="@common.code.Code@PLANNER_STATE_STOP"/>
        <bind name="PLANNER_STATE_REQUEST_RELEASE" value="@common.code.Code@PLANNER_STATE_REQUEST_RELEASE"/>
        WHERE (
        RDP_MST_STATE = #{PLANNER_STATE_ACTIVE} /* 정상 */ OR RDP_MST_STATE = #{PLANNER_STATE_STOP} /* 이용제한 */ OR RDP_MST_STATE = #{PLANNER_STATE_REQUEST_RELEASE} /* 해제요청 */
        )
        <!--        &lt;!&ndash; 활동시작일 &ndash;&gt;-->
        <!--        <if test="searchStartDate != null and searchStartDate != ''">-->
        <!--            AND RDP_MST_ATV_DT <![CDATA[>=]]> REPLACE(#{searchStartDate},'-', '') ||'000000'-->
        <!--        </if>-->
        <!--        <if test="searchEndDate != null and searchEndDate != ''">-->
        <!--            AND RDP_MST_ATV_DT <![CDATA[<=]]> REPLACE(#{searchEndDate},'-', '') ||'235959'-->
        <!--        </if>-->
        <!-- 이름 -->
        <if test="searchRdpMstMemNm != null and searchRdpMstMemNm != ''">
            AND RDP_MST_MEM_NM LIKE '%' || #{searchRdpMstMemNm} || '%'
        </if>
        <!-- 래디플래너 번호 -->
        <if test="searchRdpMstNo != null and searchRdpMstNo != ''">
            AND RDP_MST_NO LIKE '%' || #{searchRdpMstNo} || '%'
        </if>
        <!-- 이메일주소 -->
        <if test="searchRdpMstMail != null and searchRdpMstMail != ''">
            AND RDP_MST_MAIL LIKE '%' || #{searchRdpMstMail} || '%'
        </if>
        <!-- 연락처 -->
        <if test="searchRdpMstHp3 != null and searchRdpMstHp3 != ''">
            AND RDP_MST_HP3 LIKE '%' || #{searchRdpMstHp3} || '%'
        </if>
        <!-- 소속 -->
        <if test="searchRdpMstDmYn != null and searchRdpMstDmYn != ''">
            AND RDP_MST_DM_YN = #{searchRdpMstDmYn}
        </if>
        <!--        &lt;!&ndash; 사번 &ndash;&gt;-->
        <!--        <if test="searchRdpMstDmNo != null and searchRdpMstDmNo != ''">-->
        <!--            AND RDP_MST_DM_NO LIKE '%' || #{searchRdpMstDmNo} || '%'-->
        <!--        </if>-->
        <!-- 사업자유형 -->
        <if test="searchRdpMstBusiCls != null and searchRdpMstBusiCls != ''">
            AND RDP_MST_BUSI_CLS = #{searchRdpMstBusiCls}
        </if>
        <!--        &lt;!&ndash; 상태 &ndash;&gt;-->
        <!--        <if test="searchRdpMstState != null and searchRdpMstState != ''">-->
        <!--            AND RDP_MST_STATE = #{searchRdpMstState}-->
        <!--        </if>-->
        <!--        &lt;!&ndash; 등급 &ndash;&gt;-->
        <!--        <if test="searchRdpLvlIdx != null and searchRdpLvlIdx != ''">-->
        <!--            AND RDP_LVL_IDX = #{searchRdpLvlIdx}-->
        <!--        </if>-->
    </sql>

    <!-- 관리자 > 레디플래너 > 활동 플래너 목록 개수 -->
    <select id="selectPrivatePlannerListCount" parameterType="HashMap" resultType="Integer">
        /* ActivePlanner.selectActivePlannerListCount */
        SELECT COUNT(RDP_MST_IDX)
        FROM T_RDP_MST
        <include refid="prdPlannerWhere" />
    </select>

    <!-- 관리자 > 레디플래너 > 활동 플래너 목록 -->
    <resultMap id="resultPlanner" type="HashMap">
        <id property="RDP_MST_IDX" column="RDP_MST_IDX"/>
        <result property="RNUM" column="RNUM"/>
        <result property="RDP_MST_NO" column="RDP_MST_NO"/>
        <result property="RDP_MST_ID" column="RDP_MST_ID"/>
        <result property="RDP_MST_MEM_NM" column="RDP_MST_MEM_NM"/>
        <result property="RDP_MST_DM_YN" column="RDP_MST_DM_YN"/>
        <result property="RDP_MST_DM_NO" column="RDP_MST_DM_NO"/>
        <result property="RDP_MST_MAIL" column="RDP_MST_MAIL"/>
        <result property="RDP_MST_HP1" column="RDP_MST_HP1"/>
        <result property="RDP_MST_HP2" column="RDP_MST_HP2"/>
        <result property="RDP_MST_HP3" column="RDP_MST_HP3"/>
        <result property="RDP_MST_HP" column="RDP_MST_HP"/>
        <result property="RDP_MST_BUSI_CLS" column="RDP_MST_BUSI_CLS"/>
        <result property="RDP_MST_BUSI_CLS_NM" column="RDP_MST_BUSI_CLS_NM"/>
        <result property="RDP_MST_STATE_NM" column="RDP_MST_STATE_NM"/>
        <result property="RDP_LVL_NM" column="RDP_LVL_NM"/>
        <result property="RDP_MST_ATV_DT" column="RDP_MST_ATV_DT"/>
        <result property="RDP_MST_BUSI1" column="RDP_MST_BUSI1"/>
        <result property="RDP_MST_BUSI2" column="RDP_MST_BUSI2"/>
        <result property="RDP_MST_BUSI3" column="RDP_MST_BUSI3"/>
        <result property="RDP_MST_SSN1" column="RDP_MST_SSN1"/>
        <result property="RDP_MST_SSN2" column="RDP_MST_SSN2"/>
        <result property="RDP_MST_ZIP_CODE" column="RDP_MST_ZIP_CODE"/>
        <result property="RDP_MST_DR_ADDR1" column="RDP_MST_DR_ADDR1"/>
        <result property="RDP_MST_DR_ADDR2" column="RDP_MST_DR_ADDR2"/>
        <result property="RDP_MST_BNK_CD" column="RDP_MST_BNK_CD"/>
        <result property="RDP_MST_BNK_ACT" column="RDP_MST_BNK_ACT"/>
        <result property="RDP_MST_BNK_CD_NM" column="RDP_MST_BNK_CD_NM"/>
        <result property="RDP_MST_ACT_HDR" column="RDP_MST_ACT_HDR"/>
        <!-- 홍보계정 -->
        <collection property="RDP_SIT_ADR_LIST" javaType="java.util.ArrayList" ofType="HashMap">
            <id property="RDP_SIT_ADR" column="RDP_SIT_ADR"/>
        </collection>
    </resultMap>
    <select id="selectPrivatePlannerList" parameterType="HashMap" resultMap="resultPlanner">
        /* ActivePlanner.selectPrivateProductPlannerList */
        SELECT
        S2.RNUM,
        S2.RDP_MST_IDX,
        S2.RDP_MST_NO,
        S2.RDP_MST_ID,
        S2.RDP_MST_MEM_NM,
        S2.RDP_MST_DM_YN,
        S2.RDP_MST_DM_NO,
        S2.RDP_MST_MAIL,
        S2.RDP_MST_HP1,
        S2.RDP_MST_HP2,
        S2.RDP_MST_HP3,
        S2.RDP_MST_HP1 || '-' || S2.RDP_MST_HP2 || '-' || S2.RDP_MST_HP3 AS RDP_MST_HP,
        S2.RDP_MST_BUSI_CLS,
        (SELECT CMN_COM_NM FROM T_CMM_COM WHERE CMN_COM_IDX = S2.RDP_MST_BUSI_CLS) AS RDP_MST_BUSI_CLS_NM,
        (SELECT CMN_COM_NM FROM T_CMM_COM WHERE CMN_COM_IDX = S2.RDP_MST_STATE) AS RDP_MST_STATE_NM,
        (SELECT RDP_LVL_NM FROM T_RDP_LVL RL WHERE RL.RDP_LVL_IDX = S2.RDP_LVL_IDX) AS RDP_LVL_NM,
        S2.RDP_MST_ATV_DT,

        S2.RDP_MST_BUSI1,
        S2.RDP_MST_BUSI2,
        S2.RDP_MST_BUSI3,
        S2.RDP_MST_SSN1,
        S2.RDP_MST_SSN2,
        S2.RDP_MST_ZIP_CODE,
        S2.RDP_MST_DR_ADDR1,
        S2.RDP_MST_DR_ADDR2,
        S2.RDP_MST_BNK_CD,
        S2.RDP_MST_BNK_ACT,
        S2.RDP_MST_ACT_HDR,
        (SELECT CMN_COM_NM FROM T_CMM_COM WHERE CMN_COM_IDX = S2.RDP_MST_BNK_CD) AS RDP_MST_BNK_CD_NM,
        TRS.RDP_SIT_ADR

        FROM (
        SELECT
        ROWNUM AS RNUM,
        S1.*
        FROM (
        SELECT
        *
        FROM T_RDP_MST
        <include refid="prdPlannerWhere"/>
        ORDER BY RDP_MST_ATV_DT DESC
        ) S1
        ) S2,
        T_RDP_SIT TRS
        WHERE
        S2.RDP_MST_IDX = TRS.RDP_MST_IDX(+)
        <if test="startNum != null and startNum != '' and endNum != null and endNum != ''">
            AND RNUM BETWEEN #{startNum} AND #{endNum}
        </if>
    </select>

    <delete id="deletePrivateProductPlannerList">
        DELETE FROM T_PRD_PRP
        WHERE PRD_MST_CD=#{PRD_MST_CD}
    </delete>
    <insert id="insertPrivateProductPlannerList">
        INSERT ALL
        <foreach collection="RDP_MST_IDX_LIST" item="item"   separator="" >
            INTO T_PRD_PRP (PRD_MST_CD, RDP_MST_IDX, PRD_PRP_REG_DT, PRD_PRP_REG_IP, PRD_PRP_REG_ID)
            VALUES (#{PRD_MST_CD},#{item.RDP_MST_IDX},TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),#{PRD_MST_REG_IP},#{PRD_MST_REG_ID})
        </foreach>
        SELECT * FROM dual
    </insert>

    <select id="selectPrivateProductPlannerList" parameterType="HashMap" resultType="HashMap">
        SELECT A.PRD_MST_CD, A.RDP_MST_IDX, B.RDP_MST_NO, B.RDP_MST_MEM_NM
        FROM T_PRD_PRP A
        INNER JOIN T_RDP_MST B ON A.RDP_MST_IDX = B.RDP_MST_IDX
        <where>
            <if test="PRD_MST_CD != null and PRD_MST_CD != ''">
                AND A.PRD_MST_CD = #{PRD_MST_CD}
            </if>
            <if test="RDP_MST_IDX != null and RDP_MST_IDX != ''">
                AND A.RDP_MST_IDX = #{RDP_MST_IDX}
            </if>
        </where>
    </select>

</mapper>